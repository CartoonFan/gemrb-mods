IF
  OnCreation()
  !PartyHasItem("misc9r")  // ~Light Gem~
THEN
  RESPONSE #100
    SetGlobal("nolite","AR2100",0)
    TriggerActivation("Tran2102",FALSE)
END

IF
  Global("EnteredArea","AR2100",0)
THEN
  RESPONSE #100
    SetGlobal("EnteredArea","AR2100",1)
    StartMovie("FLYTHR02")
END

IF
  PartyHasItem("misc9r")  // ~Light Gem~
  Global("nolite","AR2100",0)
THEN
  RESPONSE #100
    SetGlobal("nolite","AR2100",1)
    TriggerActivation("Tran2102",TRUE)
END

IF
  !PartyHasItem("misc9r")  // ~Light Gem~
  Global("nolite","AR2100",1)
THEN
  RESPONSE #100
    TriggerActivation("Tran2102",FALSE)
    SetGlobal("lightmes","AR2100",0)
    SetGlobal("nolite","AR2100",0)
END

IF
  GlobalGT("SolaufeinJob","GLOBAL",1)
  Global("SpawnPartyOnce","AR2100",0)
THEN
  RESPONSE #100
    CreateCreature("gpmage1",[3172.2268],12)  // ~N'ashtar~
    CreateCreature("gpfam1",[3133.2229],12)  // ~Pitch~
    CreateCreature("gppri1",[3186.2143],12)  // ~Chandrilla~
    CreateCreature("gpskel1",[3376.2147],12)  // ~Skeleton~
    CreateCreature("gpsimb",[3142.2270],12)  // ~Simbja~
    CreateCreature("gpdog1",[3260.2297],12)  // ~War Dog~
    CreateCreature("gpfight1",[3346.2337],12)  // ~Boz~
    CreateCreature("gpthief1",[3789.2071],0)  // ~Damien~
    SetGlobal("SpawnPartyOnce","AR2100",1)
END

IF
  !Dead("udbalor")  // ~Balor~
  Global("EarQ1","GLOBAL",1)
THEN
  RESPONSE #100
    SetGlobal("EarQ1","GLOBAL",0)
    DisplayStringHead(Player1,51547)  // ~Do not use the earthquake scroll until the demon is defeated~
END

IF
  Dead("udbalor")  // ~Balor~
  Global("EarQ1","GLOBAL",1)
THEN
  RESPONSE #100
    SetGlobal("EarQ1","GLOBAL",2)
    TakePartyItem("miscA5")
    DestroyItem("miscA5")  // ~Stoneshape Scroll~
    PlaySound("EFF_P92")
    ScreenShake([20.20],10)
    FadeToColor([20.0],0)
    Wait(1)
    CloseDoor("Door03")
    FadeFromColor([20.0],0)
    Wait(1)
    DisplayStringHead(Player1,51549)  // ~You use the stoneshape scroll to seal the shaft and in moments the cavern looks as it did before the gnomes began mining it.~
    TriggerActivation("DemonPit",FALSE)
    ScreenShake([10.10],4)
END

IF
  SpellCast([ANYONE],WIZARD_FREEDOM)
  Global("makeMage","AR2100",0)
THEN
  RESPONSE #100
    SetInterrupt(FALSE)
    MoveViewPoint([1910.2935],INSTANT)
    CreateCreature("observe",[1900.2900],0)  // <Invalid Strref -1>
    Wait(2)
    CreateVisualEffectObject("SPFLSRIN","udfire")
    CreateVisualEffectObject("SPDISPM2","udfire")
    ActionOverride("udfire",DestroySelf())
    CreateVisualEffectObject("SPFLSRIN","udearth")
    CreateVisualEffectObject("SPDISPM2","udearth")
    ActionOverride("udearth",DestroySelf())
    CreateVisualEffectObject("SPFLSRIN","udair")
    CreateVisualEffectObject("SPDISPM2","udair")
    ActionOverride("udair",DestroySelf())
    Wait(1)
    CreateVisualEffect("SPSTRENH",[1900.2847])
    CreateVisualEffect("SPSTRENH",[2000.2847])
    CreateVisualEffect("SPSTRENH",[1900.2982])
    CreateVisualEffect("SPSTRENH",[2000.2982])
    Wait(1)
    CreateVisualEffect("SPPORTAL",[1950.2900])
    Wait(2)
    CreateCreature("udvith",[1950.2900],0)  // ~Vithal~
    Wait(1)
    DisplayStringHead("udvith",51676)  // ~When you cast the spell, its powerful magics free an imprisoned mage from the depths of the earth.~
    Wait(3)
    ActionOverride("observe",DestroySelf())
    MoveViewObject(Player1,INSTANT)
    AddexperienceParty(10000)
    SetGlobal("makeMage","AR2100",1)
    SetInterrupt(TRUE)
END

IF
  GlobalTimerExpired("dwVith","GLOBAL")
  Global("dwVithal","GLOBAL",3)
THEN
  RESPONSE #100
    CreateVisualEffectObject("SPPLANAR","udvith")
    Wait(2)
    Activate("udvith")
    GiveItemCreate("scrl8z","udvith",1,1,0)  // ~Simulacrum~
    GiveItemCreate("scrl9g","udvith",1,1,0)  // ~Abi Dalzim's Horrid Wilting~
    GiveItemCreate("scrl9e","udvith",1,1,0)  // ~Incendiary Cloud~
    GiveItemCreate("scrl9v","udvith",1,1,0)  // ~Wail of the Banshee~
    GiveItemCreate("scrl9r","udvith",1,1,0)  // ~Time Stop~
    SetGlobal("dwVithal","GLOBAL",4)
END

IF
  GlobalTimerExpired("dwVith","GLOBAL")
  Global("dwVithal","GLOBAL",13)
THEN
  RESPONSE #100
    CreateVisualEffectObject("SPPLANAR","udvith")
    Wait(2)
    Activate("udvith")
    GiveItemCreate("rods01","udvith",1,1,0)  // ~Rod of Absorption~
    SetGlobal("dwVithal","GLOBAL",14)
END

IF
  GlobalTimerExpired("dwVith","GLOBAL")
  Global("dwVithal","GLOBAL",17)
THEN
  RESPONSE #100
    CreateVisualEffectObject("SPPLANAR","udvith")
    Wait(2)
    Activate("udvith")
    GiveItemCreate("helm17","udvith",1,1,0)  // ~Skull of Death~
    SetGlobal("dwVithal","GLOBAL",18)
END

IF
  Global("spawnGnomes","AR2100",1)
THEN
  RESPONSE #100
    Wait(5)
    CreateCreature("udsvir07",[682.1246],0)  // ~Svirfneblin~
    CreateCreature("udsvir07",[682.1246],0)  // ~Svirfneblin~
    CreateCreature("udsvir07",[682.1246],0)  // ~Svirfneblin~
    CreateCreature("udsvir07",[682.1246],0)  // ~Svirfneblin~
    CreateCreature("udsvir08",[682.1246],0)  // ~Svirfneblin Leader~
    SetGlobal("spawnGnomes","AR2100",0)
END

IF
  Global("AerieInUnderdark","AR2100",0)
  InParty("Aerie")  // ~Aerie~
  !StateCheck("Aerie",STATE_SLEEPING)  // ~Aerie~
THEN
  RESPONSE #100
    SetGlobal("AerieInUnderdark","AR2100",1)
    ActionOverride("Aerie",StartDialogNoSet([PC]))
END

IF
  Global("ViconiaInUnderdark","AR2100",0)
  InParty("Viconia")  // Viconia
  !StateCheck("Viconia",STATE_SLEEPING)  // Viconia
THEN
  RESPONSE #100
    SetGlobal("ViconiaInUnderdark","AR2100",1)
    ActionOverride("Viconia",StartDialogNoSet([PC]))
END

IF
  PartyHasItem("miscbi")  // ~Magical Rope~
THEN
  RESPONSE #100
    TakePartyItemAll("miscbi")
END

IF
  PartyHasItem("key24")  // ~Sahuagin Treasury Key~
THEN
  RESPONSE #100
    TakePartyItemAll("key24")
END

IF
  GlobalLT("udMind","GLOBAL",50)
  Dead("udsimyaz")  // ~Simyaz~
  Dead("udgith02")  // ~Githyanki~
  Dead("udgith03")  // udgith03
  Dead("udgith04")  // udgith04
THEN
  RESPONSE #100
    SetGlobal("udMind","GLOBAL",50)
END

