====== What does this mod do? ======
This mods adds a new multiclass choice, sorcerer/monk. Currently dualclassing is **not** possible (see notes below).

Mage race and item restrictions, monk avatar, combined starting gear in tob, no detecting traps (custom actionbar).

{{http://lynxlynx.info/bugs/sorcerer_monk.jpg}} \\
[[http://lynxlynx.info/bugs/sorcerer_monk2.jpg|Screenshot of the game area with the merged action bar]]

Only the english strings are currently supported, but that's easily changed below.

====== Installation ======
__**IMPORTANT: this will only work on linux and mac!**__ Windows users will have do step2 by hand. \\
**IMPORTANT: not fully weidu compatible!**

===== Step 1: extending gemrb and game tables =====
Save this code snippet as something.tp2 and run it with weidu in the game directory, eg.: \\
WeiDU sorcerer.monk.tp2

<code>
BACKUP ~sorcmonk\backup~
AUTHOR ~lynxlynxlynx~
BEGIN ~Sorcerer/monk multiclass for gemrb~

// ******************************************
// first all the game table changes
APPEND ~alignmnt.2da~ ~SORCERER_MONK 1       1       1       0       0       0       0       0       0~ 
UNLESS ~SORCERER_MONK~

APPEND_COL ~weapprof.2da~ ~$ $ SORCERER_MONK 0 1 0 0 1 0 0 1 0 1 1 0 0 1 1 1 0 1 0 0 0 0 0 0 0 0 1 1 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~
UNLESS ~SORCERER_MONK~

APPEND ~profs.2da~ ~SORCERER_MONK 2 5~
UNLESS ~SORCERER_MONK~

APPEND ~xpcap.2da~ ~SORCERER_MONK 8000000~
UNLESS ~SORCERER_MONK~

APPEND_COL ~25stweap.2da~ ~$ $ SORCERER_MONK * * HELM19 BAG23 RING31 RING27 CLCK02 BOOT05 AMUL21 BRAC09 BELT10 * BULL03,40 * POTN52,5 * * * * *~
UNLESS ~SORCERER_MONK~

// if you want dualclassing
// modify the two abdc* tables, dualclass.2da
// then also change gemrb's classes.2da and add in the new MC_WAS_ID

// modify the other ab* tables if you want different stat prereqs/mods

// modify lu* for HLAs
// lazy: no special table (lusm0.2da), since currently gemrb automatically uses the hlas from all classes
// WTF @ lunumab? is the original so retarded too?
APPEND ~luabbr.2da~ ~SORCERER_MONK SM0~ UNLESS ~SORCERER_MONK~
APPEND ~lunumab.2da~ ~MULTI2SORCERER 14          1          99           1~ UNLESS ~MULTI2SORCERER~
APPEND ~lunumab.2da~ ~MULTI2MONK 14          1          99           1~ UNLESS ~MULTI2MONK~
APPEND ~lunumab.2da~ ~SORCERER_MONK 14          1          99           1~ UNLESS ~SORCERER_MONK~

// ******************************************
// GemRB unhardcoded table changes

// avatar class value (partial Animation ID)
APPEND ~avprefc.2da~ ~SORCERER_MONK          0x500~

// class details
APPEND ~classes.2da~ ~SORCERER_MONK XXX YYY ZZZ  * 786432  21  * 0x40000  -1  1  1 1 0 0  2  0~

// class skills
APPEND ~clskills.2da~ ~SORCERER_MONK   *    *    MXSPLSRC   89000   *    SKILLS    *   0     2      *  CLABMO01   -4    2500000    * 0~

// add monk fists
APPEND ~fistweap.2da~ ~21       MFIST1     MFIST1     MFIST2     MFIST2     MFIST2     MFIST3     MFIST3     MFIST3     MFIST4     MFIST4     MFIST4     MFIST5     MFIST5     MFIST5     MFIST6     MFIST6     MFIST6     MFIST7     MFIST7     MFIST7     MFIST7     MFIST7     MFIST7     MFIST7     MFIST8     MFIST8     MFIST8     MFIST8     MFIST8     MFIST8     MFIST8     MFIST8     MFIST8     MFIST8     MFIST8     MFIST8     MFIST8     MFIST8     MFIST8     MFIST8     MFIST8~

// action bar setup
APPEND ~qslots.2da~ ~SORCERER_MONK       0          3          4          2          8          9          11         12        13~

// monk "thieving" skills
APPEND_COL ~skills.2da~ ~$ $ SORCERER_MONK 10 5 -1 -1 -1 1 1 -1 -1~
</code>

===== Step 2: adding new strings =====
Paste the following into a simple text editor and save it.
<code>
#!/bin/bash
GOVERRIDEPATH="${1:-$HOME/dev/bg2/unhardcoded}"

echo "Press Ctrl-C if you're not in the top game dir. You have 1 seconds."
sleep 1
dialog=$(find -mindepth 1 -maxdepth 1 -iname dialog.tlk)
if [[ -z $dialog ]]; then
  echo "Ehh, I told you to go to the game dir!"
  exit 123
fi

strref=()
str=()
str[0]="sorcerer/monk"
str[1]="SORCERER/MONK:
This is a multiclass-only combination, no dualclassing possible. Mage race and item restrictions, monk avatar, combined starting gear in tob, no detecting traps (custom actionbar) ..."
str[2]="SORCERER/MONK"

echo Backing up current $dialog to $dialog.gemrb.backup
cp "$dialog" "$dialog.gemrb.backup"
echo

# now we can insert them into dialog.tlk
# since we need the resulting strrefs, we can't just add and forget
for i in $(seq ${#str[@]}); do
  WeiDU --strapp "${str[$i-1]}" --tlkout "$dialog" || exit 1
  strref[$i-1]=$(WeiDU --strfind "${str[$i-1]}" | grep  "~${str[$i-1]}~" |
                 sed -n '/String/ { s,String #\([[:digit:]]*\) .*$,\1,p; q }')
done
echo USE THESE as CLASSES.2DA ENTRIES for the first three columns (replace XXX, YYY, ZZZ)
WeiDU --string ${strref[0]} | grep String
WeiDU --string ${strref[1]} | grep String
WeiDU --string ${strref[2]} | grep String
</code>

Then run it like:
<code>
bash mychosenfilename /path/to/bg2
</code>
The path should point to where you installed the game.

====== Uninstallation ======
You can copy back the dialog.tlk created during the installation. Rerun weidu if you want to uninstall the game&gemrb data modifications.

